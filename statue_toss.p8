pico-8 cartridge // http://www.pico-8.com
version 27
__lua__
â§— = 0
half_w = 128/2

grab = {
	x = 0,
	lastx = 0,
	y = 0,
	â§— = 0
}

statue = {
	x = half_w - 8,
	y = 84,
	w = 32,
	h = 16,
	grabbed = false,
	vx = 0,
	vy = 0
}

peps = {}

-- skin colors

--pal(3, 3+128, 1)

function _init()
 prewarm_clouds()
 
	while #peps < 100 do
		local x = rnd_range(-50, 100)
		local y = rnd_range(78, 128)
		
		if not ( y > 90 and y < 120) then
			add(peps, {
				x = x,
				y = y,
				c = rnd_el({15, 4, 0})
			})
		end
	end
end


function _update60()
	â§—+= .01

	local ly = btn(âŽ) and 90 or 30 
 local lx = btn(âŽ) and 60 or 40
  
 if btn(ðŸ…¾ï¸) then 
 	-- release
 	if statue.grabbed then 
 		statue.grabbed = false
 		statue.vx = (grab.x - grab.lastx)/2
 	end
 end
  
 -- regular swing 
	local sx = half_w + sin(â§—) * lx
	local sy = ly + abs(cos(â§—)) * 20
	
	-- lerp position
	grab.lastx = grab.x
	grab.x = lerp(sx, grab.x, 0.7)
	grab.y = lerp(sy, grab.y, 0.7)
	
	-- grabbing the statue
	if grab.x > statue.x and grab.y > statue.y  
				and grab.x < statue.x + 10 and grab.y < statue.y + 10
				and btn(âŽ)
				then
		statue.grabbed = true
	end		
	
	-- statue physics
	if statue.grabbed then
		statue.x = grab.x - statue.w/2
		statue.y = grab.y - statue.h/3
	else
	 if statue.y < 84 then
	 	 statue.vy += 0.1
	 else  
	 	 statue.vy = 0
	 	 statue.vx = 0
	 end
	 
		statue.x += statue.vx
		statue.y += statue.vy
	end
end



function _draw() 
	-- sky
	cls(12)

		
	-- ground
	rectfill(0, 80, 128, 128, 3)
	--rectfill(0, 100, 100, 115, 6)
	map()
	
	-- water
	
		
	-- clouds
	draw_update_clouds()
	
	-- draw peps
	draw_peps()
		
	-- vertical crane
	for y = 10, 100, 16 do
		spr(2, half_w - 40, y, 1, 2)
	end
	
	-- top horizontal
	for x = half_w - 50, half_w, 8 do
		spr(3, x, 10)
	end
	
	
	-- control room
	spr(4,27, 13)
	
	
	-- statue
 palt(11, 0)
 palt(0, false)
	spr(64, statue.x, statue.y, 4, 4)
	palt()
	
	-- grab
	line(half_w, 13, grab.x, grab.y, 1)
	spr(btn(âŽ) and 17 or 1, grab.x - 4, grab.y)
	pset(grab.x, grab.y, 7)

	
end


function draw_peps()
--	pal(0, 128, 1)
-- pal(5, 5+128, 1)
-- pal(6, 6+128, 1)
	for p in all(peps) do
		print("ì›ƒ", p.x, p.y, p.c)
	end
end
-->8
function lerp(tar,pos,perc)
 return (1-perc)*tar + perc*pos;
end

function rnd_range(low, high)
 return low + rnd(high - low)
end

function rnd_el(arr)
 return arr[ceil(rnd(#arr))]
end

-->8
-- clouds
clouds = {}

function prewarm_clouds()
	for i = 0, 10 do 
	 local cloud ={
    x = rnd_range(0, 128),
    y = rnd_range(-10, 30),
    vy = 0,
    vx = rnd_range(.05, .1),
    â§— = rnd_range(0, 300),
    puffs = {}
  }
  for i=0,rnd_range(2,5) do
   add(cloud.puffs, {
    maxr = rnd_range(2,5),
    xoffset = rnd_range(-5, 5),
    yoffset =  rnd_range(-2, 2)
   })
  end

  add(clouds, cloud)
	end
end

function draw_update_clouds()
	if rnd() > 0.99 and #clouds < 100 then
  local cloud ={
    x = rnd_range(-40, 40),
    y = rnd_range(-10, 30),
    vy = 0,
    vx = rnd_range(.05, .1),
    â§— = 0,
    puffs = {}
  }
  for i=0,rnd_range(2,5) do
   add(cloud.puffs, {
    maxr = rnd_range(2,5),
    xoffset = rnd_range(-5, 5),
    yoffset =  rnd_range(-2, 2)
   })
  end

  add(clouds, cloud)
 end

 for c in all(clouds) do
  c.â§— += 1
  c.y += c.vy
  c.x += c.vx
  if c.x > 384 then 
   del(clouds, c)
  end
  for p in all(c.puffs) do
    circfill(c.x + p.xoffset, c.y + p.yoffset, min(c.â§— / 100, p.maxr), 7)
  end
 end
end

__gfx__
0000000000000000daaaa000aaaaaaaad6666600000000000000000000000000cccccccc66666666111111116666666600000000000000000000000055555555
0000000005556550da0aa00009090909d677c6000000000dddd0000000000000cccccccc66666666111111116666666600000000000000005555550055555555
0070070005110150daada0009a9a9a9ad67c7600000000dd5500000000000000cccccccc666666661111111166dd666600000000000000005005050055555555
0007700005100050da0da000ddddddddd6777600000000d5555005500b00b000cccccccc66666666111111116666666600000000000000005005050050005505
0007700005100150da0aa00000000000d6777600000d0dd555555550000b0000cccccccc66666666111111116666666600000000000000005005050050005505
0070070000501500daada00000000000d6666600000dd55555555555000000b0cccccccc666666661111111166666ddd00000000000000005555550050005505
0000000000000000da0da00000000000d6666600000d55555550050000b00000cccccccc66666666111111116666666600000000000000005050050050005505
0000000000000000da0aa00000000000dddddd00000050555550000000000000cccccccc66666666111111116666666600000000000000005050050055555555
0000000000000000daada00000000000000000000000505055500000000000000000000066666666666666666660000066600000660000000000000000000000
0000000005556550da0da00000000000000000000000505050050000000000000000000066666666666666666650000066600000666000000000000000000000
0000000005110150da0aa00000000000000000000005555555555000000000000000000066666666666666666500000066600000666000000000000000000000
0000000051000010daada00000000000000000000555555555555550010000000000000055555555555555555000000066600000666000000000000000000000
0000000051000010da0da00000000000000000005555555555555555000000000000000000000000000000000000000066600000666000000000000000000000
0000000000000000da0aa0000000000000000000555555555555555500000010000000000b000000000000000000000066600000666000000000000000000000
0000000000000000daada0000000000000000000555555555555555500b0000000000000000000b0000000000000000066600000666000000000000000000000
0000000000000000da9aa0000000000000000000555555555555555500000000000000000000000000000b000000000066600000666000000000000000000000
00000000000000000000000000000000000000000000000000333000000000000000000000000000511111110000000000000000000000000000000000000000
00000000000000000000000000000000000000000033bb000033bb00000000000000000000000000611111110000000000000000000000000000000000000000
000000000000000000000000000000000000000003333b0000333b00000000000000000000000000511111110000000000000000000000000000000000000000
00000000000000000000000000000000000000000bb34bb000334b00000000000000000000000000611111110000000000000000000000000000000000000000
000000000000000000000000000000000000000003b433b000343000000000000000000000000000511111110000000000000000000000000000000000000000
00000000000000000000000000000000000000000333330000333000000000000000000000000000611111110000000000000000000000000000000000000000
00000000000000000000000000000000000000000005400000054000000000000000000000000000511111110000000000000000000000000000000000000000
00000000000000000000000000000000000000000004400000044000000000000000000000000000611111110000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbbbbbb77bbbbbbbbbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbbbbb7157bbbbbbbbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbbbb75d57bbbbbbbbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbbbb71017bbbbbbbbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbbbb700017bbbbbbbb777bbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbbbb7d1007bbbbb7771d07bbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbbbb75115077b775d1001d7bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbb77777755555107dd51001150bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bb77777d5dddd155150dd555101107bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b7110d51115510011554d5d0070007bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
710750109055111511d0055070007bbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
71571119000005111051204070507bbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7077710000000101010020057707bbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
707b70000000000000002007bb7bbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
717b70000000000000000107bbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
717b7010077700000000007bbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
717b75007bbb7777005507bbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b7b77007bbbbbbbb777007bbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbb71107bbbbbbbbbb7007bbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bb71007bbbbbbbbbbb7007bbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bb70d07bbbbbbbbbbb707bbbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bb707077bbbbbbbbbb707bbbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bb707107bbbbbbbbb710bbbbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b71177177bbbbbbbb7007bbbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b7757d117bbbbbbbbb7017bbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbb7777bbbbbbbbbbbb77bbbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0808080808080808080808080808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0808080808080808080808080808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08080808080808080808080f0808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08080808080808080808080f0f0f0f0f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2727272727270e0e0e0e0e0f0f0f0f0f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07101010101010100710101010102a0a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000007070017000000000700002a0a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0b09090909090b0909090909091d2a0a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
09090b090909090909090b09091c2a0a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
191a1a191a1a1a191a1a1919191b2a0a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07000007070700000007000007002a0a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000017000000070707000007002a0a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00070717071707000000071700002a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000170707171700002a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
